<div class="homepage-container">
  <!-- Top Navigation Bar -->
  <mat-toolbar class="navbar">
    <div class="nav-left">
      <div class="logo-section">
        <mat-icon class="logo-icon">home</mat-icon>
        <span class="logo-text">EstateHub</span>
      </div>
    </div>

    <div class="nav-center" [formGroup]="filterForm">
        <mat-form-field appearance="outline" class="search-field">
          <mat-icon matPrefix>search</mat-icon>
          <input matInput 
          formControlName="searchQuery"
          placeholder="Search by location, property name...">
          <button mat-icon-button matSuffix *ngIf="filterForm.get('searchQuery')?.value" (click)="filterForm.get('searchQuery')?.setValue('')">
            <mat-icon>clear</mat-icon>
          </button>
        </mat-form-field>
    </div>

    <div class="nav-right">
      <button mat-raised-button color="accent" class="list-property-btn" (click)="navigateToListProperty()">
        <mat-icon>add_home</mat-icon>
        List Property
      </button>
      <button *ngIf="!authService.isLoggedIn()" 
              mat-stroked-button 
              class="signin-btn" 
              (click)="navigateToLogin()">
        <mat-icon>login</mat-icon>
        Sign In
      </button>
      <button *ngIf="authService.isLoggedIn()" 
              mat-icon-button 
              [matMenuTriggerFor]="profileMenu">
        <mat-icon>account_circle</mat-icon>
      </button>
      <mat-menu #profileMenu="matMenu">
        <button mat-menu-item routerLink="/profile">
          <mat-icon>dashboard</mat-icon>
          <span>Dashboard</span>
        </button>
        <button mat-menu-item>
          <mat-icon>favorite</mat-icon>
          <span>Saved Properties</span>
        </button>
        <button mat-menu-item (click)="navigateToListProperty()">
          <mat-icon>add</mat-icon>
          <span>List Property</span>
        </button>
        <mat-divider></mat-divider>
        <button mat-menu-item (click)="logout()">
          <mat-icon>logout</mat-icon>
          <span>Sign Out</span>
        </button>
      </mat-menu>
    </div>
  </mat-toolbar>

  <!-- Main Content Area -->
  <div class="main-content">
    <!-- Google Maps Container -->
    <div #mapContainer class="map-container" 
         [class.with-properties]="isListViewOpen"
         [class.with-filters]="isFilterPanelOpen"></div>

    <!-- Filter Panel -->
    <div class="filter-panel" [class.open]="isFilterPanelOpen">
      <div class="filter-header">
        <h3>Filters</h3>
        <button mat-icon-button (click)="toggleFilterPanel()">
          <mat-icon>close</mat-icon>
        </button>
      </div>

      <div class="filter-content" [formGroup]="filterForm">
        <!-- Property Type -->
         <h3>Property Type</h3>
         <div class="filter-section">
            <mat-select formControlName="propertyType">
              <mat-option *ngFor="let type of propertyTypes" [value]="type">
                {{ type }}
              </mat-option>
            </mat-select>
         </div>


        <!-- Price Range -->
        <h3>Price Range (Million HUF)</h3>
        <div class="price-inputs">
          <div class="price-container">
            <input matInput type="number" formControlName="minPrice" placeholder="Min" step="0.1">
            <span class="unit">M HUF</span>
          </div>

          <div class="price-container">
            <input matInput type="number" formControlName="maxPrice" placeholder="Max" step="0.1">
            <span class="unit">M HUF</span>
          </div>
        </div>

        <!-- Bedrooms -->
        <h3>Bedrooms</h3>
        <div class="filter-section">
            <mat-select formControlName="bedrooms">
              <mat-option [value]="0">Any</mat-option>
              <mat-option [value]="1">1+</mat-option>
              <mat-option [value]="2">2+</mat-option>
              <mat-option [value]="3">3+</mat-option>
              <mat-option [value]="4">4+</mat-option>
              <mat-option [value]="5">5+</mat-option>
            </mat-select>
        </div>

        <!-- Bathrooms -->
        <h3>Bathrooms</h3>
        <div class="filter-section">
            <mat-select formControlName="bathrooms">
              <mat-option [value]="0">Any</mat-option>
              <mat-option [value]="1">1+</mat-option>
              <mat-option [value]="2">2+</mat-option>
              <mat-option [value]="3">3+</mat-option>
              <mat-option [value]="4">4+</mat-option>
            </mat-select>
        </div>

        <!-- Area Range -->
        <h3>Area (Square Meters)</h3>
          <div class="price-inputs">
            <div class="price-container">
              <input matInput type="number" formControlName="minArea" placeholder="Min">
              <span matSuffix>m²</span>
            </div>
            <div class="price-container">
              <input matInput type="number" formControlName="maxArea" placeholder="Max">
              <span matSuffix>m²</span>
            </div>
          </div>

        <!-- Filter Actions -->
        <div class="filter-actions">
          <button mat-stroked-button (click)="resetFilters()" class="reset-btn">
            Reset
          </button>
          <button mat-raised-button color="primary">
            Apply ({{ filteredProperties.length }})
          </button>
        </div>
      </div>
    </div>

    <!-- Properties List Panel -->
    <div class="properties-panel" [class.open]="isListViewOpen">
      <div class="properties-header">
          <h3>Properties ({{ filteredProperties.length }})</h3>
            <button mat-icon-button (click)="toggleListView()" matTooltip="Lista bezárása">
              <mat-icon>close</mat-icon>
            </button>
      </div>
      
      <div class="properties-content">
        <mat-card *ngFor="let property of filteredProperties" 
                  class="property-card"
                  (click)="selectProperty(property)">
          <div class="property-image">
            <img [src]="property.image" [alt]="property.title">
            <div class="property-badges">
              <span class="badge type">{{ property.type }}</span>
            </div>
          </div>
          <mat-card-content class="property-info">
            <h4>{{ property.title }}</h4>
            <p class="price">{{ formatPrice(property.price) }}</p>
            <p class="address">{{ property.address }}</p>
            <div class="property-details">
              <span class="detail">
                <mat-icon>bed</mat-icon>
                {{ property.bedrooms || 0 }}
              </span>
              <span class="detail">
                <mat-icon>bathtub</mat-icon>
                {{ property.bathrooms || 0 }}
              </span>
              <span class="detail">
                <mat-icon>square_foot</mat-icon>
                {{ formatArea(property.area || 0) }}
              </span>
            </div>
          </mat-card-content>
        </mat-card>

        <!-- Empty state -->
        <div *ngIf="filteredProperties.length === 0" class="empty-state">
          <mat-icon>home_work</mat-icon>
          <h3>No results</h3>
          <p>No property matches the specified filter criteria.</p>
          <button mat-raised-button color="primary" (click)="resetFilters()">
            Clear filters
          </button>
        </div>
      </div>
    </div>

    <!-- Toggle buttons for closed panels -->
    <button *ngIf="!isFilterPanelOpen" 
            mat-fab 
            color="accent" 
            class="toggle-filters-btn"
            (click)="toggleFilterPanel()"
            matTooltip="Open Filters">
      <mat-icon>tune</mat-icon>
    </button><button *ngIf="!isListViewOpen" 
            mat-fab 
            color="accent" 
            class="toggle-properties-btn"
            (click)="toggleListView()"
            [matBadge]="filteredProperties.length"
            matBadgeColor="warn"
            matTooltip="List of properties">
      <mat-icon>list</mat-icon>
    </button>

    <!-- Property Details Modal -->
    <div class="property-modal" *ngIf="selectedProperty" (click)="closePropertyDetails()">
      <mat-card class="property-details-card" (click)="$event.stopPropagation()">
        <button mat-icon-button class="close-button" (click)="closePropertyDetails()">
          <mat-icon>close</mat-icon>
        </button>
        
        <!-- Image Gallery -->
        <div class="property-gallery">
          <!-- Main Image -->
          <div class="main-image-container">
            <img 
              [src]="selectedProperty.images && selectedProperty.images.length > 0 ? 
                    selectedProperty.images[currentImageIndex] : 
                    'https://via.placeholder.com/400'" 
              [alt]="selectedProperty.title"
              class="main-image">
            
            <!-- Navigation Arrows -->
            <button *ngIf="selectedProperty.images && selectedProperty.images.length > 1" 
                    mat-icon-button class="nav-arrow prev-arrow" (click)="prevImage(); $event.stopPropagation()">
              <mat-icon>chevron_left</mat-icon>
            </button>
            <button *ngIf="selectedProperty.images && selectedProperty.images.length > 1" 
                    mat-icon-button class="nav-arrow next-arrow" (click)="nextImage(); $event.stopPropagation()">
              <mat-icon>chevron_right</mat-icon>
            </button>
            
            <!-- Image Counter -->
            <div *ngIf="selectedProperty.images && selectedProperty.images.length > 1" class="image-counter">
              {{ currentImageIndex + 1 }} / {{ selectedProperty.images.length }}
            </div>
            
            <div class="property-badges">
              <span class="badge type">{{ selectedProperty.type }}</span>
            </div>
          </div>
          
          <!-- Thumbnail Gallery -->
          <div *ngIf="selectedProperty.images && selectedProperty.images.length > 1" 
              class="thumbnail-gallery">
            <div class="thumbnails-container">
              <div 
                *ngFor="let image of selectedProperty.images; let i = index" 
                class="thumbnail-item"
                [class.active]="i === currentImageIndex"
                (click)="selectImage(i); $event.stopPropagation()">
                <img [src]="image" [alt]="'Thumbnail ' + (i + 1)">
              </div>
            </div>
          </div>
        </div>

        <mat-card-content>
          <h2>{{ selectedProperty.title }}</h2>
          <p class="price-large">{{ formatPrice(selectedProperty.price) }}</p>
          <p class="address">{{ selectedProperty.address }}, {{ selectedProperty.city }}</p>
          
          <div class="description" *ngIf="selectedProperty.description">
            <p>{{ selectedProperty.description }}</p>
          </div>
          
          <div class="details-grid">
            <div class="detail-item">
              <mat-icon>bed</mat-icon>
              <span>{{ selectedProperty.bedrooms || 0 }} Bedrooms</span>
            </div>
            <div class="detail-item">
              <mat-icon>bathtub</mat-icon>
              <span>{{ selectedProperty.bathrooms || 0 }} Bathrooms</span>
            </div>
            <div class="detail-item">
              <mat-icon>square_foot</mat-icon>
              <span>{{ formatArea(selectedProperty.area || 0) }}</span>
            </div>
            <div class="detail-item">
              <mat-icon>home</mat-icon>
              <span>{{ selectedProperty.type }}</span>
            </div>
            <div class="detail-item">
              <mat-icon>location_city</mat-icon>
              <span>{{ selectedProperty.city }}</span>
            </div>
            <div class="detail-item">
              <mat-icon>calendar_today</mat-icon>
              <span>Listed {{ selectedProperty.created_at | date:'shortDate' }}</span>
            </div>
          </div>

          <div class="action-buttons">
            <button mat-raised-button color="primary" (click)="revealEmail()">
              <mat-icon>schedule</mat-icon>
              Schedule Viewing
            </button>
            <button mat-raised-button color="primary" (click)="revealPhone()">
              <mat-icon>phone</mat-icon>
              Contact Agent
            </button>
            <button class="like-button"
                    (click)="toggleLike(selectedProperty, $event)"
                    [class.liked]="isLiked(selectedProperty.id)"
                    matTooltip="Like this property">
              <mat-icon>{{ isLiked(selectedProperty.id) ? 'favorite' : 'favorite_border' }}</mat-icon>
            </button>
          </div>

          <!-- Stylish floating alerts -->
          <div class="floating-alert" *ngIf="showEmail">
            <mat-icon>email</mat-icon>
            <span>{{ selectedProperty.email }}</span>
            <button mat-icon-button class="close-alert" (click)="showEmail = false">
              <mat-icon>close</mat-icon>
            </button>
          </div>

          <div class="floating-alert" *ngIf="showPhone">
            <mat-icon>phone</mat-icon>
            <span>{{ selectedProperty.phoneNumber }}</span>
            <button mat-icon-button class="close-alert" (click)="showPhone = false">
              <mat-icon>close</mat-icon>
            </button>
          </div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>
</div>